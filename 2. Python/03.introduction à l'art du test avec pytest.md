# Introduction à pytest (en cours de rédaction)

## Pré-requis
- Vocabulaire : test automatique
- Savoir utiliser pip en ligne de commande

## Objectifs
- Savoir installer pytest
- Savoir écrire un test
- Savoir lancer un test

## Qu'est-ce que pytest ?

Pytest est un framework permettant de mettre en place des tests automatiques dans un projet Python. 
Il est simple à installer et utiliser. Bien qu'il ne soit pas nécessaire de s'en servir dès le départ, pytest propose énormément de fonctionnalité qui permettent d'aller plus loin dans l'art du testing au fur et à mesure que l'on acquiert la maîtrise de celui-ci. 

Dans ce chapitre, tu apprendras à installer pytest et à l'utiliser de manière classique. 

## Installation de pytest

Grâce à la magie de Python et de *pip*, pytest s'installe très facilement.

Vérifions déjà qu'il ne soit pas installé. Dans un terminal, exécute la commande suivante : 
```bash
python -m pytest --version
```

S'il n'est pas installé, tu devrais obtenir le résultat suivant : 
```bash
No module named pytest
```

C'est le cas ? Tu peux donc l'installer. Toujours dans le terminal : 
```bash
python -m pip install pytest
```

Une fois le traitement terminé, on revérifie l'installation : 
```bash
python -m pytest --version
```

Moi, j'obtiens cette ligne qui m'indique que la version *7.0.1* de *pytest* est installée : 
```bash
pytest 7.0.1
```

## Utilisation de pytest

Maintenant que pytest est correctement installé, tu vas pouvoir l'utiliser et écrire ton premier test unitaire. Je t'invite à créer un répertoire `start_with_pytest`. Nous placerons tes premiers tests dedans. Rentre dans ce répertoire en mode terminal et essayons d'exécuter les tests qui se trouvent dedans (pour rappel, il n'y en a pas).

### Un test se lance ou ne se lance pas

Pour lancer les tests, il faut que tu exécutes la commande suivante : 
```bash
python -m pytest
```

et tu obtiens (à peu près) le résultat suivant : 
```bash
====================================== test session starts ======================================
platform win32 -- Python 3.10.0, pytest-7.0.1, pluggy-1.0.0
rootdir: C:\Projets\start_with_pytest
collected 0 items

===================================== no tests ran in 0.01s =====================================
```

Désormais, tu sais ce qu'il se passe quand pytest ne parvient pas à trouver des tests dans le répertoire courant.

Nous allons maintenant mettre en place notre premier test. Je t'invite à créer le fichier `test_something.py` et à mettre le code suivant dedans : 

```python
def test_do_something_useful():
	pass
```
et exécutons de nouveau nos tests (dernier rappel : `python -m pytest`) : 
```bash
====================================== test session starts ======================================
platform win32 -- Python 3.10.0, pytest-7.0.1, pluggy-1.0.0
rootdir: C:\Projets\start_with_pytest
collected 1 item

test_something.py .                                                                        [100%]

======================================= 1 passed in 0.01s =======================================
```

Certaines données changent. Notre fichier test_something.py apparait, avec un indicateur 100%. Cet indicateur indique le pourcentage de test exécutés à ce stade. La ligne en dessous `1 passed in 0.01s` indique le nombre de tests exécutés ainsi que le temps total d'exécution.

Pytest détecte automatiquement les tests, mais il faut appliquer quelques règles. Essayons de comprendre les plus simples.

Modifies le fichier de la manière suivante : 
```python
def do_something_useful():
	pass
```

et exécutes les tests : 
```bash
====================================== test session starts ======================================
platform win32 -- Python 3.10.0, pytest-7.0.1, pluggy-1.0.0
rootdir: C:\Projets\start_with_pytest
collected 0 items

===================================== no tests ran in 0.01s =====================================
```

Tu as enlevé le préfixe `test` du nom de la fonction. Tu peux donc en déduire que pytest se base sur le mot `test` pour déterminer si une fonction est un test. Tu peux essayer de le mettre en suffixe, tu constateras que le test n'est pas reconnu. Une fonction est donc reconnue comme un test si elle est préfixée par `test`.

Maintenant, refais marcher le test puis renomme le fichier `test_something.py` en `something.py`. Même résultat, il faut le préfixe `test` dans le nom du fichier.

Essaye maintenant de le renommer en `something_test.py` : 

```bash
====================================== test session starts ======================================
platform win32 -- Python 3.10.0, pytest-7.0.1, pluggy-1.0.0
rootdir: C:\Projets\start_with_pytest
collected 1 item

something_test.py .                                                                        [100%]

======================================= 1 passed in 0.01s =======================================
```

Le test est détecté. Tu peux donc préfixer ou sufixer le nom de ton fichier pour qu'il soit reconnu comme un fichier de test. Par contre, (je t'invite à essayer), le mot `test` au milieu du nom ne permet pas de détecter le fichier.

### Un test passe ou échoue
Maintenant que nous avons vu les raisons pour lesquelles un test se lance, nous allons voir qu'un test peut passer ou échouer.

Passer signifie que le test exécute un code qui répond à **TOUTES** les *spécifications* attendues par le développeur. Au contraire, un code qui échoue au test ne répond pas à au moins **UNE** spécification.

Par exemple, le test que tu as manipulé (dans les cas où il était lancé) passait parce que son code répondait à toutes les spécifications, c'est à dire aucune. Je n'ai indiqué aucune raison d'échouer, il est donc passé.










































